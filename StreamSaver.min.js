;((name,definition)=>{typeof module!=='undefined'?module.exports=definition():typeof define==='function'&&typeof define.amd==='object'?define(definition):this[name]=definition()})('streamSaver',()=>{'use strict'let iframe,background const test=fn=>{try{fn()}catch(e){}}const ponyfill=window.WebStreamsPolyfill||{}const once={once:true}const firefox='MozAppearance'in document.documentElement.style const mozExtension=location.protocol==='moz-extension:'const streamSaver={createWriteStream,WritableStream:window.WritableStream||ponyfill.WritableStream,supported:false,version:{full:'1.2.0',major:1,minor:2,dot:0},mitm:'https://jimmywarting.github.io/StreamSaver.js/mitm.html?version=1.2.0',ping:'https://jimmywarting.github.io/StreamSaver.js/ping.html?version=1.2.0'}function makeIframe(src){const iframe=document.createElement('iframe')iframe.hidden=true iframe.src=src iframe.addEventListener('load',()=>{iframe.loaded=true},once)document.body.appendChild(iframe)return iframe}test(()=>{background=chrome.extension.getBackgroundPage()===window})test(()=>{streamSaver.supported='serviceWorker'in navigator&&!!new ReadableStream()})test(()=>{const{readable}=new TransformStream()const mc=new MessageChannel()mc.port1.postMessage(readable,[readable])mc.port1.close()mc.port2.close()Object.defineProperty(streamSaver,'TransformStream',{configurable:false,writable:false,value:TransformStream})})const isSecureContext=window.isSecureContext&&(!firefox||!background)function iframePostMessage(url,args){iframe=iframe||makeIframe(url)if(iframe.loaded){iframe.contentWindow.postMessage(...args)}else{iframe.addEventListener('load',()=>{iframe.contentWindow.postMessage(...args)},once)}}function load(url,noTabs,popUp){let popup={close:()=>(popup.closed=1),fns:[],onLoad:fn=>popup.fns.push(fn)}if(!noTabs&&window.chrome&&chrome.tabs&&chrome.tabs.create){chrome.tabs.create({url:url,active:false},popup2=>{popup.close=()=>chrome.tabs.remove(popup2.id)if(popup.closed){popup.close()}else{let fn chrome.tabs.onUpdated.addListener(fn=(tabId,_,tab)=>{if(tabId===popup2.id&&tab.status==='complete'){chrome.tabs.onUpdated.removeListener(fn)popup.onLoad=fn=>fn()popup.fns.forEach(popup.onLoad)}})}})}else{if(popUp||!firefox&&!isSecureContext){popup=window.open(url,Math.random())}else{popup.close=(x=>()=>x.remove())(makeIframe(url))}}return popup}function createWriteStream(filename,queuingStrategy,size){if(Number.isFinite(queuingStrategy)){[size,queuingStrategy]=[queuingStrategy,size]}let channel=new MessageChannel()let popup let hash=''let setupChannel=readableStream=>new Promise(resolve=>{const transferable=[channel.port2]const request={filename,size}const args=[request,'*',transferable]if(readableStream){channel.port1.postMessage({readableStream},[readableStream])request.transferringReadable=true}channel.port1.onmessage=evt=>{if(evt.data.download){resolve()if(popup){if(!hash&&!iframe&&firefox){iframePostMessage(streamSaver.ping,[evt.data,'*'])}popup.close()}popup=load(evt.data.download,isSecureContext)if(readableStream){channel.port1.onmessage=null channel.port1.close()channel.port2.close()}}else{if(popup){if(firefox)popup.close()popup=null}channel.port1.onmessage=null}}if(isSecureContext){return iframePostMessage(streamSaver.mitm,args)}if(!hash&&mozExtension&&!streamSaver.transformStream){hash='#'+Math.random()}popup=load(streamSaver.mitm+hash,!hash,true)if(popup.postMessage){let onready=evt=>{if(evt.source===popup){popup.postMessage(...args)window.removeEventListener('message',onready)}}window.addEventListener('message',onready)}else{popup.onLoad(()=>{args[0].hash=hash iframePostMessage(streamSaver.ping,args)})}})if(streamSaver.TransformStream){const ts=new streamSaver.TransformStream({start(){return new Promise(resolve=>setTimeout(()=>setupChannel(ts.readable).then(resolve)))}},queuingStrategy)return ts.writable}return new streamSaver.WritableStream({start(){return setupChannel()},write(chunk){channel.port1.postMessage(chunk)},close(){channel.port1.postMessage('end')},abort(){channel.port1.postMessage('abort')}},queuingStrategy)}return streamSaver});
